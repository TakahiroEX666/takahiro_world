<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        	
        <title>Storyboard By TKH</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
        <link rel="stylesheet" href="./css/navbar.css" />
        <link rel="stylesheet" href="./node_modules/material-icons/iconfont/material-icons.css" />
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.6/dist/umd/supabase.min.js"></script>
        <script src="https://www.youtube.com/iframe_api"></script>
        <style>
            @font-face {
            font-family: 'Eng';
            src: url('./css/SFProDisplay-Regular.woff2') format('woff2');
            unicode-range: U+0000-00FF;
            }
            @font-face {
            font-family: 'Thai';
            src: url('./css/SFThonburi-Regularr.woff2') format('woff2');
            unicode-range: U+0E00-0E7F;
            }
            @font-face {
            font-family: 'Emoji';
            src: url('./css/NotoColorEmoji.ttf') format('truetype');
            unicode-range: U+1F300-1FAFF, U+2600-26FF;
            }
            @font-face {
            font-family: 'Playwrite HU';
            src: url('./css/PlaywriteHU.ttf') format('truetype');
            }
            html {
            font-size: 85%; /* 0.85 √ó 16px = 13.6px */
            }
            
            :root {                                                        
                    /*var(--bg-light);*/                                                           
                    --bg-light: #FFFFFF; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
                    --bg-dark: #1e1e1e; /* ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ Dark Mode ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ñ‡πâ‡∏≤‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°) */
                    --card-light: #ffffff;
                    --card-dark: #2c2c2c;
                    --text-light: #333;
                    --text-dark: #eee;
                    --primary-color: #1a73e8; /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏Å */
                    --youtube-red: #ff0000;
                    --note-blue: #1976d2;
                    --emotion-yellow: #fbbc05;
                    --upload-green: #34a853;
                    --moment-purple: #9c27b0;
            }
            
            
            
            body {
                    font-family: 'Eng', 'Thai', 'Emoji', sans-serif;
                    color: #0f1419;'
                    margin: 0;
                    padding-bottom: 0;
                    margin-top:0;
                    max-width: 900px;
                    margin-inline: auto;
                    position: relative;
            }
            
            
            .feed-container {
                    display: flex;
                    flex-direction: column;
                    overflow-y: auto;
                    padding-top: 56px !important;
                    height: calc(100vh - 60px); /*Adjust based on header height, minus potential pinned cards */
                    scroll-behavior: smooth;
            }
            
            .feed-post {                        
                    padding: 16px 20px;
                    position: relative;
                    border: 1px solid #eff3f4;
            }
            
            .feed-post.child-post {
                    margin-top:12px;
                    border-radius: 12px;
                    /* margin-left: 20px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
                    border-left: 2px solid #eff3f4; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
                    /* padding-left: 16px; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
                    /*border-top: none; /* ‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
            }



            
            .feed-post-cardview .feed-post {
                    margin: 1rem;
                    border-radius: 8px; /*16*/
                    box-shadow: 0 2px 4px rgba(239, 243, 244, 1); /*4,8*/
                    transition: background 0.3s;
                    margin-bottom: 16px;
            }
            
            .feed-post-cardview .feed-post.child-post {
                    margin-left: 20px;
                    border-left: 2px solid #ccc;
                    padding-left: 16px;
                    border-radius: 0;
                    margin-top: 0;
                    margin-bottom: 0;
                    box-shadow: none;
            }
           
            
            
            .feed-post-hidden {
                    padding: 6px 20px;
                    background: #eff3f4;
                    color: #536471;
            }            
           
            .feed-post-hidden-icons {
            }
            
            
            .post-meta {
            gap: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            }
            
            .post-type-useraccount{
            display: inline-flex;
            align-items: center;
            font-size: 1.1rem;            
            }
            
            .profile-container {
            width: 32px; 
            height: 32px; 
            overflow: hidden; 
            border-radius: 50%; 
            margin-right:8px;
            }
            
            
            .profile-pic {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            }
            
            
            .post-type-label {
            display: inline-flex;
            Padding: 4px 16px;
            align-items: center;
            font-size: 0.925rem;
            color: white;
            border-radius: 100px;
            text-transform: uppercase;
            font-weight: bold;
            }
  


            .post-type-label-text.mood { color:  #0f1419}
            .post-type-label-text.note { color: #ffb300}
            .post-type-label-text.ig-pics {                
                    background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);                                                        
                    background-clip: text;
                    -webkit-background-clip: text;                           
                    color: transparent;            }
            .post-type-label-text.youtube { color: #ff0000 }
            .post-type-label-text.quote { color: #03a9f4; }
            



          
            
            .post-type-label.mood { background-color:  #0f1419}
            .post-type-label.note { background-color: #ffb300}
            .post-type-label.ig-pics {
            background: #f09433; /* fallback for older browsers */
            background: -moz-linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            background: -webkit-linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f09433', endColorstr='#bc1888',GradientType=1 );
            }
            .post-type-label.youtube { background-color: #ff0000 }
            .post-type-label.quote { background-color: #03a9f4; }
            .post-type-icon {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 0.925rem;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
            margin-right: 4px;
            }
                                       
            
            .post-type-time {
            font-size: 0.875rem; /*0.9rem*/
            color: #536471;
            flex-ditection: row-reverse;
            }
            
            
            .post-text {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            font-size:1.05rem;
            
            margin-top: 12px;
            }
                     
            
            .post-quote {
            margin-top: 12px;
            position: relative;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            font-size:1.1rem;
            padding-left: 15px;
            color: black;
            }
            
            
            .post-quote::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: #536471;
            border-radius: 5px;
            }
            
            
            
            .post-tags {
            display: flex;
            flex-wrap: wrap; /* ‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
            gap: 8px; /* ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á tag ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
            margin-top: 12px;
            }
            .post-tags .tag {
            font-size: 1.1rem;
            color: white;
            white-space: nowrap; /* ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° tag ‡∏´‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
            user-select: none;
            }
            .post-location {
            margin-top: 12px;
            padding: 8px 16px;
            border-radius:12px;
            border: 1px solid #eff3f4;
            font-size: 1.1rem;
            display:flex;
            align-items:center;
            gap:12px;
            }
            .post-location-icon {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 36px;
            color: red;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
            }
            .location-title {
            font-weight:bold;
            }
            
            
            
            .yt-card {
            margin-top: 12px;
            background:#222;
            padding:12px;
            border-radius:12px;
            max-width:500px;
            color:#fff;
            display:flex;
            align-items:center;
            gap:12px;
            }
            .yt-thumb {
            aspect-ratio: 16 / 9;
            border-radius:8px;
            object-fit:cover;
            width:120px; height:80px;
            }
            .yt-title {
            font-weight:bold;
            font-size:1rem;
            white-space:nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
            }
            .yt-channel {
            color:#ccc;
            font-size:0.85rem;
            }
            .controls button {
            background: #444;
            border: none;
            color: white;
            font-size: 24px;
            border-radius: 50%;
            padding: 8px;
            transition: background 0.2s;
            }
            .controls button {
            background: #444;
            border: none;
            color: white;
            font-size: 24px;
            border-radius: 50%;
            padding: 8px;
            transition: background 0.2s;
            }



            .hidden-posts-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem 0;
            }
            .hidden-post-card {
            background: #f1f1f1;
            border-radius: 8px;
            padding: 1rem;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .hidden-post-card .post-text {
            color: #555;
            }
            .post-img-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
            }
            .post-img-group img {
            width: 100%;
            border-radius: 8px;
            object-fit: contain;
            background-color: #eee;
            cursor: pointer;
            }
            .post-img-group .more-images {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1.2rem;
            border-radius: 8px;
            height: 80px;
            cursor: pointer;
            }
            iframe {
            width: 100%;
            height: 200px;
            margin-top: 0.5rem;
            border-radius: 12px;
            }
            .note-link {
            color: var(--note-blue);
            text-decoration: none;
            cursor: pointer;
            font-weight: 500;
            }
            
            
            
            /* Floating Action Button (FAB) */
            .fab-button {
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    /*background: #0F1419;*/
                    /*background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);        */
                    background:#3C58A7;                                               
                    
                    border: none;
                    border-radius: 50%;
                    width: 56px;
                    height: 56px;
                    font-size: 2rem;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
                    cursor: pointer;
                    z-index: 100;
                    transition: transform 0.2s ease-in-out;
            }
            
            .fab-button:active {
            transform: scale(0.95);
            }
            
            
            
            
            
            
            /* Input Bottom Sheet (replaces note-form) */
            .input-bottom-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            backdrop-filter: blur(1px);
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
            }
            .input-bottom-sheet-overlay.active {
            visibility: visible;
            opacity: 1;
            }
            .input-bottom-sheet {
            background: white;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            width: 100%;
            max-width: 900px;
            padding: 1.5rem 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            }
            .input-bottom-sheet-overlay.active .input-bottom-sheet {
            transform: translateY(0);
            }
            .input-bottom-sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            }
            .input-bottom-sheet-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--text-light);
            }
            .input-bottom-sheet-header .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: gray;
            }
            .input-row-sheet {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
            width: 100%;
            position: relative;
            }
            .input-row-sheet textarea {
            flex: 1;
            box-sizing: border-box;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 25px;
            background: var(--bg-light);
            color: var(--text-light);
            resize: none;
            min-height: 40px;
            overflow-y: auto;
            line-height: 1.5;
            }
            .input-sheet-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            }
            .input-sheet-actions .left-actions,
            .input-sheet-actions .right-actions {
            display: flex;
            gap: 0.5rem;
            }
            .input-sheet-actions .icon-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: gray;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.2s;
            }
            .input-sheet-actions .icon-button:hover {
            background: #eee;
            }
            .input-sheet-actions .send-button {
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            padding: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            /* Emoji Selection Popover - Position adjusted for bottom sheet */
            #emojiSelectionPopover {
            position: absolute; /* Changed to absolute to be within the bottom sheet context */
            bottom: calc(1rem + 60px); /* Adjust based on input area height in bottom sheet */
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 2rem);
            max-width: 400px;
            background: var(--card-light);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 1rem;
            display: none;
            z-index: 99; /* Below bottom sheet, above general content */
            box-sizing: border-box;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            }
            body.dark #emojiSelectionPopover {
            background: var(--card-dark);
            border-color: #444;
            }
            #emojiSelectionPopover .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 0.5rem;
            justify-items: center;
            }
            #emojiSelectionPopover .emoji-button {
            font-size: 1.8rem;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.2rem;
            border-radius: 8px;
            transition: background 0.1s;
            }
            #emojiSelectionPopover .emoji-button:hover {
            background: #eee;
            }
            body.dark #emojiSelectionPopover .emoji-button:hover {
            background: #555;
            }
            /* Other Bottom Sheets (Filter, Delete) - Remain similar positioning */
            .bottom-sheet-overlay {
            position: fixed;
            backdrop-filter: blur(10px);
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
            }
            .bottom-sheet-overlay.active {
            visibility: visible;
            opacity: 1;
            }
            .bottom-sheet {
            background: white;
            backdrop-filter: blur(10px);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            width: 100%;
            max-width: 900px;
            padding: 1.5rem 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            }
            .bottom-sheet-overlay.active .bottom-sheet {
            transform: translateY(0);
            }
            .bottom-sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            }
            .bottom-sheet-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--text-light);
            }
            .bottom-sheet-header .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: gray;
            }
            .filter-options, .action-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            }
            .filter-options button, .action-options .action-button {
            background: var(--bg-light);
            border: 1px solid #ccc;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-light);
            /*transition: background 0.2s, border-color 0.2s;*/
            width: auto; /* For filter buttons */
            text-align: center;
            }
            .filter-options button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            }
            /* Action buttons specific styles */
            .action-options {
            flex-direction: column; /* Force vertical stacking for action buttons */
            }
            .action-options .action-button {
            width: 100%; /* Full width for action buttons */
            border-radius: 8px; /* Slightly less rounded than filter buttons */
            }
            .action-options .action-button.delete-action {
            background: #ffe0e0;
            color: #d32f2f;
            border-color: #ffcdd2;
            }
            .action-options .action-button.pin-action {
            background: #e0f2f7;
            color: #007bb6;
            border-color: #b3e5fc;
            }
            /* Image Modal Styles - Stays similar */
            .image-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
            }
            .image-modal-overlay.active {
            visibility: visible;
            opacity: 1;
            }
            .image-modal-content {
            position: relative;
            background: #222;
            padding: 1rem;
            border-radius: 16px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            }
            .image-modal-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            }
            .full-image-container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            gap: 10px;
            padding: 20px;
            box-sizing: border-box;
            scroll-behavior: smooth;
            }
            .full-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            background-color: #000;
            }
            /* Camera Modal Styles - Stays similar */
            #cameraModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1003;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
            }
            #cameraModal.active {
            visibility: visible;
            opacity: 1;
            }
            #cameraModal video {
            max-width: 95vw;
            max-height: 80vh;
            background-color: black;
            border-radius: 8px;
            transform: scaleX(-1);
            }
            #cameraModal .camera-controls {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
            }
            #cameraModal .camera-controls button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            }
            #cameraModal .camera-controls button.close-camera-button {
            background: #d32f2f;
            }
            .header-bar {
            transition: transform 0.3s ease;
            }
            .post-text p,
            .post-text h1,
            .post-text h2,
            .post-text h3,
            .post-text h4,
            .post-text h5,
            .post-text h6,
            .post-text ul,
            .post-text ol{
            margin: 0px;
            padding: 0px;
            display: inline;
            }
            .post-quote p,
            .post-quote h1,
            .post-quote h2,
            .post-quote h3,
            .post-quote h4,
            .post-quote h5,
            .post-quote h6,
            .post-quote ul,
            .post-quote ol{
            margin: 0px;
            padding: 0px;
            display: inline;
            }
            .bottom-sheet2 {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 16px 20px;
            box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.2);
            }
            /* Container ‡∏ó‡∏µ‡πà‡∏´‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏° textarea */
            .input-wrapper {
            margin-top: 12px;
            position: relative;
            width: 100%;
            box-sizing: border-box;
            /* CSS Custom Properties (Variables) */
            --before-background-color: transparent;
            --before-margin-right: 0px; /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ */
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏° transition ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏±‡∏ö smooth ‡∏Ç‡∏∂‡πâ‡∏ô */
            transition: padding-left 0.2s ease-in-out;
            }
            /* ‡πÉ‡∏ä‡πâ ::before ‡∏Å‡∏±‡∏ö container ‡πÅ‡∏ó‡∏ô textarea */
            .input-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            border-radius: 5px;
            background-color: var(--before-background-color);
            transition: background-color 0.2s ease-in-out;
            }
            /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö textarea ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ */
            .input-area {
            font-family: 'Eng', 'Thai', 'Emoji', sans-serif;
            font-size: 1.25rem;
            color: #333;
            line-height: 1.5;
            min-height: 120px;
            padding: 0;
            width: 100%;
            box-sizing: border-box;
            border: none;
            outline: none;
            resize: none;
            /*
            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ padding-left ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏ô textarea ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
            ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ margin-right
            */
            padding-left: calc(var(--before-margin-right));
            transition: padding-left 0.2s ease-in-out;
            }
            /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö placeholder */
            .input-area::placeholder {
            color: #aaa;
            }
            .input-area2 {
            font-size: 1.25rem;
            color: #333;
            line-height: 1.5;
            margin-bottom:20px;
            margin-top: 12px;
            width: 100%; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° width ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
            padding:0;
            box-sizing: border-box; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! */
            border: none; /* ‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏≠‡∏≠‡∏Å */
            outline: none;
            resize: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î textarea */
            }
            .post-type-label2 {
            margin-top:12px;
            display: inline-flex;
            Padding: 4px 16px;
            align-items: center;
            font-size: 0.925rem;
            background-color:  #0f1419;
            color: white;
            border-radius: 100px;
            text-transform: uppercase;
            font-weight: bold;
            }
            .post-type-label2.mood {
            background-color:  #0f1419;
            }
            .post-type-label2.youtube {
            background-color:  red;
            }
            .post-type-icon2 {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 0.925rem;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
            margin-right: 4px;
            }
            /*---  ---*/
            .actions {
            display: flex;
            align-items: center;
            border-top: 2px solid #eff3f4;
            padding-top: 12px;
            justify-content: space-between;
            gap: 16px; /*  */
            }
            .left-actions {
            display: flex;
            flex: 1; /*  */
            overflow-x: auto; /*  */
            -webkit-overflow-scrolling: touch; /*  iOS */
            /* padding-bottom: 4px; /*  */
            }
            /*  scrollbar  */
            .left-actions::-webkit-scrollbar {
            display: none;
            }
            .right-actions {
            display: flex;
            align-items: center;
            gap: 16px; /*  archived  POST */
            }
            .icons {
            display: flex;
            gap: 16px;
            font-size: 2rem;
            color: #666;
            }
            .post-btn {
            flex-shrink: 0; /*  */
            background: black;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 100px;
            font-weight: bold;
            cursor: pointer;
            }
            .post-btn:hover {
            background: #222;
            }
            .input-bottom-sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            }
            .input-bottom-sheet-header h3 {
            margin: 0;
            font-size: 1.25rem;
            }
            .input-bottom-sheet-header .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: gray;
            }
            .sheet-icon {
            font-family: 'Material Icons Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 1.75rem;
            color: #6b7280;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
            }
            #tagInputContainer {
            margin-bottom: 15px;
            font-size: 1.25rem;
            color: #333;
            margin-bottom:20px;
            margin-top: 12px;
            box-sizing: border-box; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! */
            border: none; /* ‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏≠‡∏≠‡∏Å */
            outline: none;
            }
            #tagInputContainer[contenteditable="true"]:empty:before {
            content: "#";
            color: #aaa;
            }
            .tag-in-input {
            color: #007bff; /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Tag */
            font-weight: bold;
            white-space: nowrap;
            }
            .hashtag {
            color: #3897F0; /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hashtag */
            /* font-weight: bold;*/
            white-space: nowrap;
            }
            .mention {
            color: #D10869; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mention */
            /*font-weight: bold;*/
            white-space: nowrap;
            }
            .space-span {
            white-space: pre;
            color: #000;
            }
            #tagList {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            text-align: left;
            }
            #tagList li {
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            color: #333;
            }
            #image-upload {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            }
            #image-preview-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            }
            .image-card {
            position: relative;
            width: 90px;
            height: 90px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f9f9f9;
            }
            .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            }
            .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 14px;
            line-height: 14px;
            text-align: center;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            }
            .delete-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
            }
            /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö textarea ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ */
            .input-area6 {
            font-family: 'Eng', 'Thai', 'Emoji', sans-serif;
            font-size: 1.25rem;
            color: #333;
            height: 32px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ */
            padding: 0;
            width: 100%;
            box-sizing: border-box;
            border: none;
            outline: none;
            resize: none;
            /*
            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ padding-left ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏ô textarea ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
            ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ margin-right
            */
            }
            /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö placeholder */
            .input-area::placeholder {
            color: #aaa;
            }
            .bottom-sheet-header6 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 200px;
            }
            
            
            
            
                        /* Overlay */
            .overlayAI {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            }
            .overlayAI.active { opacity: 1; visibility: visible; }
            /* Bottom Sheet */
            
            
            .bottom-sheetAI         {
            position: fixed;
            bottom: -100%;
            left: 0;
            width: 100%;
            height: 80vh; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 90% ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
            /*max-height: 90%;*/
            /*background: rgba(255,255,255,0.95);*/
            background: white;
            backdrop-filter: blur(10px);
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            box-shadow: 0 -8px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            transition: bottom 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 1001;
            transition: transform 0.3s ease-out;
            }
            .bottom-sheetAI.active { bottom: 0; }
            /* Header */
            .aichat_sheet-header {
            padding: 16px 20px;
            border-bottom: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            /*background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);*/
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            font-weight: 600;
            font-size: 1.25rem;
            }
            .close-btnAI {
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s ease;
            }
            .close-btn:hover { transform: rotate(90deg); }
            /* Chat Body */
            .chat-bodyAI {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
            }
            .messageAI {
            max-width: 70%;
            border-radius: 28px;
            font-size: 1rem;
            line-height: 1.4;
            word-wrap: break-word;
            position: relative;
            display: inline-block;
            }
            .messageAI.user {
            align-self: flex-end;
            /*background: #007AFF;*/
            background: linear-gradient(135deg, #8b5cf6, #3b82f6); 
            padding: 12px 18px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            color: #fff;
            border-bottom-right-radius: 6px;
            }
            .messageAI.bot {
            align-self: flex-start;
            margin-top: 12px;
            max-width: 100%;
            background: #f1f3f6
            color: #333;
            /*border-bottom-left-radius: 6px;*/
            }
            .chat-boxAI {
            background: #fff;
            /*border-radius: 1.5rem;*/
            /*padding: 1.5rem;
            border: 1px solid #f3f4f6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);*/
            padding:1rem;=
            }
            .chat-inputAI  {
            position: relative;
            }
            .chat-inputAI textarea {
            font-family: 'Eng', 'Thai', 'Emoji', sans-serif;
            width: 100%;
            border: none;
            outline: none;
            /*border: 1px solid #e5e7eb;*/
            border: 1px solid #ccc;
            border-radius: 28px;
            padding: 1rem 3rem 1rem 1rem;
            font-size: 1rem;
            /*background: #f9fafb;*/
            resize: none;
            overflow: hidden;
            transition: all 0.3s;
            }
            .btnAI {
            position: absolute;
            right: 0.75rem;
            bottom: 0.45rem;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            width: 36px;
            height: 36px;
            font-size: 20px;
            border: none;
            background: transparent;
            transition: all 0.2s;
            opacity: 1;
            transform: scale(1);
            }
            .btnAI.hidden {
            opacity: 0;
            transform: scale(0);
            }
            .btnAI-photo {
            color: #3b82f6;
            }
            .btnAI-photo:hover {
            background: #eff6ff;
            }
            .btnAI-send {
            /*background: #3b82f6;*/
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: #fff;
            /*box-shadow: 0 2px 6px rgba(59,130,246,0.3);*/
            }
            /* Scrollbar Minimal */
            .chat-bodyAI::-webkit-scrollbar { width: 4px; }
            .chat-bodyAI::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 2px; }

            
            
            .fab-button svg {
            	width: 32px;
            height: 32px;
            fill: currentColor;
            
            }
            
            
            
            
            
            
        </style>
    </head>
    <body>
        <!-- NAVBAR -->
        <div class="navbar" id="navbar" style="box-shadow:none;">
            <div class="left-icons">
                <button class="icon-button"><span class="title" style="font-family: 'Playwrite HU'; text-align: center; line-height: 1.5;">Storyboard</span></button>
            </div>
            <div class="right-icons">
                <button class="icon-button"><span class="material-icons icon">search</span></button>
                <button class="icon-button"><span class="material-icons icon" style="display: none;">calendar_today</span></button>
                <button class="icon-button" onclick="showFilterOptions()"><span class="material-icons icon">more_vert</span></button>
            </div>
        </div>
        <!-- FEED -->
        <div class="feed-container" id="feedContainer">
            <div id="postsContainer"></div>
        </div>
        <!-- FAB INPUT -->
        	
        <button class="fab-button" style="margin-bottom:128px;" id="openBtnSora">
        <span style="color: white;">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320.3 205C256.8 204.8 205.2 256.2 205 319.7C204.8 383.2 256.2 434.8 319.7 435C383.2 435.2 434.8 383.8 435 320.3C435.2 256.8 383.8 205.2 320.3 205zM319.7 245.4C360.9 245.2 394.4 278.5 394.6 319.7C394.8 360.9 361.5 394.4 320.3 394.6C279.1 394.8 245.6 361.5 245.4 320.3C245.2 279.1 278.5 245.6 319.7 245.4zM413.1 200.3C413.1 185.5 425.1 173.5 439.9 173.5C454.7 173.5 466.7 185.5 466.7 200.3C466.7 215.1 454.7 227.1 439.9 227.1C425.1 227.1 413.1 215.1 413.1 200.3zM542.8 227.5C541.1 191.6 532.9 159.8 506.6 133.6C480.4 107.4 448.6 99.2 412.7 97.4C375.7 95.3 264.8 95.3 227.8 97.4C192 99.1 160.2 107.3 133.9 133.5C107.6 159.7 99.5 191.5 97.7 227.4C95.6 264.4 95.6 375.3 97.7 412.3C99.4 448.2 107.6 480 133.9 506.2C160.2 532.4 191.9 540.6 227.8 542.4C264.8 544.5 375.7 544.5 412.7 542.4C448.6 540.7 480.4 532.5 506.6 506.2C532.8 480 541 448.2 542.8 412.3C544.9 375.3 544.9 264.5 542.8 227.5zM495 452C487.2 471.6 472.1 486.7 452.4 494.6C422.9 506.3 352.9 503.6 320.3 503.6C287.7 503.6 217.6 506.2 188.2 494.6C168.6 486.8 153.5 471.7 145.6 452C133.9 422.5 136.6 352.5 136.6 319.9C136.6 287.3 134 217.2 145.6 187.8C153.4 168.2 168.5 153.1 188.2 145.2C217.7 133.5 287.7 136.2 320.3 136.2C352.9 136.2 423 133.6 452.4 145.2C472 153 487.1 168.1 495 187.8C506.7 217.3 504 287.3 504 319.9C504 352.5 506.7 422.6 495 452z"/></svg>
</span>
        </button>
        
        
        	<button class="fab-button" style="margin-bottom:64px;" id="openBtnAI">
        <span class="material-icons icon" style="color: white;">forum</span>
        </button>
        
        <button class="fab-button" id="openBtnCreate" onclick="showInputBottomSheet()">
            <span class="material-icons icon" style="color: white;">post_add</span>
        </button>
        
        

         
        
        

        
                <div class="overlayAI" id="overlayAI">
        <div class="bottom-sheetAI" id="bottomSheetAI">
            <div class="aichat_sheet-header">
                AI Chat
                <span class="close-btnAI" id="closeBtnAI">&times;</span>
            </div>
            <div class="chat-bodyAI" id="chatBodyAI">
                <!-- <div class="message ai">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?</div> -->
            </div>
            <div class="chat-boxAI">
                <div class="chat-inputAI">
                    <textarea id="messageInputAI" rows="1" placeholder="‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."></textarea>
                    <!-- Add Photo Button -->
                    <button id="addPhotoButtonAI" class="btnAI btnAI-photo">
                    üì∑
                    </button>
                    <!-- Send Button -->
                    <button id="sendButtonAI" class="btnAI btnAI-send hidden">
                    <span class="sheet-icon" style="font-family: 'Material Icons';">location_on</span>
                    </button>
                </div>
            </div>
        </div>
        </div>
        
        
        
        
        
        
        
        
        <!-- INPUT BOTTOM SHEET -->
        <div class="input-bottom-sheet-overlay" id="inputBottomSheet">
            <div class="bottom-sheet2">
                <div class="input-bottom-sheet-header">
                    <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå</h3>
                    <button class="close-button" onclick="hideInputBottomSheet()"><i class="fas fa-times"></i></button>
                </div>
                <div id="image-preview-area">
                </div>
                <div id="chipsArea">
                    <span class="post-type-label2 mood" id="dynamicChip"><i class="post-type-icon2 mood" id="chipIcon">favorite_border</i><span id="chipText">mood</span></span>
                </div>
                <div class="input-row-sheet5">
                    <div class="input-wrapper">
                        <textarea class="input-area" id="titleInput" placeholder="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏á..."></textarea>
                    </div>
                    <div class="input-area2" id="tagInputContainer" contenteditable="true"></div>
                    <button id="submitButton" style="display: none;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                    <ul id="tagList"></ul>
                </div>
                <div class="actions">
                    <div class="left-actions">
                        <div class="icons">
                            <label><span class="sheet-icon">image</span><input type="file" id="imageInput" accept="image/*" multiple hidden /></label>
                            <span class="sheet-icon">mic</span>
                            <span class="sheet-icon" style="font-family: 'Material Icons';">location_on</span>
                            <span class="sheet-icon" onclick="toggleEmojiPopover()">add_reaction</span>
                            <span class="sheet-icon" onclick="openCameraModal()">alternate_email</span>
                            <span class="sheet-icon" onclick="openCameraModal()">camera_alt</span>
                            <span class="sheet-icon" id="quoteedit-bt">format_quote</span>
                        </div>
                    </div>
                    <div class="right-actions">
                        <span class="sheet-icon" id="askai-bt">archive</span>
                        <button class="post-btn" onclick="saveFeeling()">POST</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="emojiSelectionPopover">
            <div class="emoji-grid">
                <button class="emoji-button">üòä</button>
                <button class="emoji-button">üò¢</button>
                <button class="emoji-button">üò≠</button>
                <button class="emoji-button">üò°</button>
                <button class="emoji-button">üòç</button>
                <button class="emoji-button">üò¥</button>
                <button class="emoji-button">ü•π</button>
                <button class="emoji-button">üòÇ</button>
                <button class="emoji-button">ü•∞</button>
                <button class="emoji-button">üëç</button>
                <button class="emoji-button">‚ù§Ô∏è</button>
                <button class="emoji-button">üî•</button>
                <button class="emoji-button">ü§î</button>
                <button class="emoji-button">üëç</button>
                <button class="emoji-button">üòÇ</button>
                <button class="emoji-button">ü§©</button>
                <button class="emoji-button">ü•≥</button>
                <button class="emoji-button">ü§Ø</button>
                <button class="emoji-button">ü•∫</button>
                <button class="emoji-button">üòá</button>
                <button class="emoji-button">üíî</button>
                <button class="emoji-button">üíØ</button>
                <button class="emoji-button">üéâ</button>
                <button class="emoji-button">‚ú®</button>
                <button class="emoji-button">üí°</button>
                <button class="emoji-button">üí¨</button>
            </div>
        </div>
        <div class="bottom-sheet-overlay" id="hiddenPostsBottomSheet">
            <div class="bottom-sheet">
                <div class="bottom-sheet-header">
                    <h3>‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô</h3>
                    <button class="close-button" onclick="hideHiddenPosts()"><i class="fas fa-times"></i></button>
                </div>
                <div class="hidden-posts-container" id="hiddenPostsContainer"></div>
            </div>
        </div>
        <!-- SETTING BOTTOM SHEET-->
        <div class="bottom-sheet-overlay" id="filterBottomSheet">
            <div class="bottom-sheet">
                <div class="bottom-sheet-header">
                    <h3>Filter by Type</h3>
                    <button class="close-button" onclick="hideFilterOptions()"><i class="fas fa-times"></i></button>
                </div>
                <div class="filter-options" id="filterOptions">
                    <button class="active" data-filter="all">All</button>
                    <button data-filter="emotion">Emotion</button>
                    <button data-filter="note">Note</button>
                    <button data-filter="upload">Upload</button>
                    <button data-filter="youtube">Youtube</button>
                    <button data-filter="moment">Moment</button>
                </div>
                <h3>Post View</h3>
                <div class="filter-options" id="postView">
                    <button class="active">Thread View</button>
                    <button>Card View</button>
                </div>
                <h3>Order Position</h3>
                <div class="filter-options" id="sort">
                    <button class="active">Bottom</button>
                    <button>Top</button>
                </div>
            </div>
        </div>
        <!-- CARD ACTION BOTTOM SHEET-->
        <div     class="bottom-sheet-overlay" id="deleteBottomSheet">
            <div class="bottom-sheet">
                <div class="bottom-sheet-header">
                    <h3>Action on Card</h3>
                    <button class="close-button" onclick="hideDeleteOptions()"><i class="fas fa-times"></i></button>
                </div>
                <div class="action-options">
                    <button class="action-button delete-action" onclick="confirmDelete()">Delete Card</button>
                    <button class="action-button pin-action" onclick="togglePinCard()">Pin Card</button>
                    <button class="action-button cancel-action" onclick="hideDeleteOptions()">Cancel</button>
                </div>
            </div>
        </div>
        <div class="bottom-sheet-overlay" id="replyBottomSheet">
        <div class="bottom-sheet">
            <div class="bottom-sheet-header">
                <h3></h3>
                <button class="close-button" onclick="hideDeleteOptions2()">
                <i class="fas fa-times"></i>
                </button>
            </div>
            <span id="post-text-getter"></span>
            <div>
                <div class="bottom-sheet-header6">
                    <textarea class="input-area6" id="titleInput6" placeholder="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏á..."></textarea>
                    <span class="sheet-icon" onclick="togglePinCard2()" style="font-family: 'Material Icons';font-size:1.5rem; margin-left:16px;margin-right:16px">send</span>
                </div>
            </div>
        </div>
        <div class="image-modal-overlay" id="imageModal">
            <div class="image-modal-content">
                <button class="image-modal-close-button" onclick="closeImageModal()"><i class="fas fa-times"></i></button>
                <div class="full-image-container" id="fullImageContainer"></div>
            </div>
        </div>
        <div class="image-modal-overlay" id="cameraModal">
            <div class="image-modal-content" style="max-width: 95vw; max-height: 95vh; padding: 0;">
                <button class="image-modal-close-button close-camera-button" onclick="closeCameraModal()"><i class="fas fa-times"></i></button>
                <video id="cameraFeed" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
                <div class="camera-controls">
                    <button onclick="capturePhoto()"><i class="fas fa-camera"></i> Capture</button>
                </div>
            </div>
        </div>
        
        
        
        
        
        
        
        
        
        
        
    




    
        
        
      <!--  <script src="script.js"></script>-->
      
      
      
      
      
      
      
      
      
      
      
      
        
        
    






        <script>
/*const supabase = window.supabase.createClient(
  "https://fkntlawaawawiusmjsez.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrbnRsYXdhYXdhd2l1c21qc2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5ODcxMjAsImV4cCI6MjA2NTU2MzEyMH0.G-_fLzcpvPla3dUYNCV7qh0j-JHo1Ahr5fS7fQkHdpw"
);        */
const OPENROUTER_API_KEY = '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';

// DOM Elements
const messageInputAI = document.getElementById('messageInputAI');
const sendButtonAI = document.getElementById('sendButtonAI');
const addPhotoButtonAI = document.getElementById('addPhotoButtonAI');
const chatBodyAI = document.getElementById('chatBodyAI');
const bottomSheetAI = document.getElementById('bottomSheetAI');
const overlayAI = document.getElementById('overlayAI'); 
const openBtn = document.getElementById('openBtn');
const closeBtnAI = document.getElementById('closeBtnAI');

// Auto-resize input
function autoResize() {
  messageInputAI.style.height = 'auto';
  messageInputAI.style.height = Math.min(messageInputAI.scrollHeight, 120) + 'px';
}
messageInputAI.addEventListener('input', () => {
  autoResize();
  const hasText = messageInputAI.value.trim().length > 0;
  addPhotoButtonAI.classList.toggle('hidden', hasText);
  sendButtonAI.classList.toggle('hidden', !hasText);
});

// Bottom sheet
function openSheet() {
  bottomSheetAI.classList.add('active');
  overlayAI.classList.add('active');
  messageInputAI.focus();
}
function closeSheet() {
  bottomSheetAI.classList.remove('active');
  overlayAI.classList.remove('active');
}
openBtnAI.addEventListener('click', openSheet);
closeBtnAI.addEventListener('click', closeSheet);
overlayAI.addEventListener('click', closeSheet);





















// Supabase fetch posts
async function getAllPosts() {
  const start = performance.now();
  const { data, error } = await supabase
    .from('storyboard')
    .select('title')
    .order('created_at', { ascending: true })
    .limit(10);
  const end = performance.now();
  console.log(`‚è±Ô∏è Query storyboard ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ${(end - start).toFixed(2)} ms`);
  if (error) {
    console.error(error);
    return [];
  }
  return data.map(post => post.title);
}








async function buildContext(session_id) {
      	
      // 1. Dynamic state
  const { data: profile } = await supabase
    .from("ai_userprofile")
    .select("*")
    .eq("session_id", session_id)
    .single();
      
      
  // 1. Dynamic state
  const { data: state } = await supabase
    .from("ai_session_state")
    .select("*")
    .eq("session_id", session_id)
    .single();

  // 2. Memory (summarized)
  const { data: memory } = await supabase
    .from("ai_conversation_memory")
    .select("*")
    .eq("session_id", session_id)
    .order("updated_at", { ascending: false })
    .limit(1);

  // 3. Recent messages
  const { data: messages } = await supabase
    .from("ai_messages")
    .select("*")
    .eq("session_id", session_id)
    .order("created_at", { ascending: true })
    .limit(10);

  return {
  	profile,
      state,
      memory: memory?.[0],
      recent: messages || []
  };
}











// Build messages for AI
async function buildMessages(userText) {
  const oldPosts = await getAllPosts();
  const systemPrompt = {
    role: "system",
   content: `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏£‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö "‡∏Ñ‡πà‡∏∞"
‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:
${oldPosts.map((p,i) => `${i+1}. ${p}`).join('\n')}

‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏ß‡∏¢ empathy ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à`



  };
  return [systemPrompt, { role: "user", content: userText }];
}










// Append message to chat
function appendMessage(text, role='bot') {
  const msg = document.createElement('div');
  msg.className = `messageAI ${role}`;
  msg.innerText = text;
  chatBodyAI.appendChild(msg);
  chatBodyAI.scrollTop = chatBodyAI.scrollHeight;
}

// Streaming AI response
async function streamChat(messages) {
  appendMessage("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...", 'bot'); // placeholder
  const lastMsg = chatBodyAI.querySelector('.messageAI.bot:last-child');

  try {
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: messages,
        temperature: 0.7,
        stream: true
      })
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder("utf-8");
    let resultText = "";

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      const chunk = decoder.decode(value, { stream: true });
      const lines = chunk.split("\n").filter(l => l.trim() !== "");

      for (const line of lines) {
        if (!line.startsWith("data: ")) continue;
        const jsonStr = line.replace(/^data: /, "");
        if (jsonStr === "[DONE]") continue;

        try {
          const parsed = JSON.parse(jsonStr);
          const content = parsed.choices[0].delta?.content;
          if (content) {
            resultText += content;
            lastMsg.innerText = resultText; // update DOM ‡πÅ‡∏ö‡∏ö realtime
          }
        } catch (e) {
          console.error("JSON parse error:", e, line);
        }
      }
    }

  } catch (err) {
    console.error(err);
    lastMsg.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI";
  }
}

// Send message
async function sendMessage() {
	
	
  const text = messageInputAI.value.trim();
  if (!text) return;

  appendMessage(text, 'user');
  messageInputAI.value = '';
  autoResize();

  const messages = await buildMessages(text);
  await streamChat(messages);
}

// Event listeners
sendButtonAI.addEventListener('click', sendMessage);
messageInputAI.addEventListener('keypress', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
</script>













    
        
        <script>
            document.addEventListener('DOMContentLoaded', () => {
            const titleInput6 = document.getElementById('titleInput6');
            const submitButton = document.getElementById('submitButton');
            
            // Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á textarea
            function autoResize() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            }
            
            // Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå
            function checkInput() {
            if (titleInput6.value.trim() !== '') {
            submitButton.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            } else {
            submitButton.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            }
            }
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô textarea
            titleInput6.addEventListener('input', () => {
            checkInput();
            autoResize.call(titleInput6); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î
            });
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
            const bottomSheet = document.querySelector('.bottom-sheet2');
            const inputElement = bottomSheet.querySelector('input-area'); // ‡∏´‡∏£‡∏∑‡∏≠ element ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÇ‡∏ü‡∏Å‡∏±‡∏™
            
            // ‡πÉ‡∏ä‡πâ Visual Viewport API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ö‡∏ô Android
            if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
            const viewportHeight = window.visualViewport.height;
            const fullViewportHeight = window.innerHeight;
            const keyboardHeight = fullViewportHeight - viewportHeight;
            
            // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Bottom Sheet ‡πÇ‡∏î‡∏¢‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏û‡πâ‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
            if (keyboardHeight > 0) {
                // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á
                bottomSheet.style.bottom = `${keyboardHeight}px`;
            } else {
                // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ã‡πà‡∏≠‡∏ô
                bottomSheet.style.bottom = '0px';
            }
            });
            }
            
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Bottom Sheet ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡∏∞ input ‡πÇ‡∏ü‡∏Å‡∏±‡∏™
            const bottomSheetOverlay = document.querySelector('.bottom-sheet-overlay');
            bottomSheetOverlay.addEventListener('transitionend', (e) => {
            if (e.target.classList.contains('active')) {
            // ‡πÇ‡∏ü‡∏Å‡∏±‡∏™ input ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Bottom Sheet ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà
            inputElement.focus();
            }
            });
            });
        </script>
        <script>
            const imageUpload = document.getElementById('imageInput');
            const imagePreviewArea = document.getElementById('image-preview-area');
            
            let selectedFiles = [];
            
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Array
            function renderPreviews() {
                imagePreviewArea.innerHTML = ''; // ‡∏•‡∏ö preview ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                
                
                
                
                selectedFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    
                    
                    
                    reader.onload = function(e) {
                        const imageCard = document.createElement('div');
                        imageCard.classList.add('image-card');
                        
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = file.name;
                        
                        const deleteBtn = document.createElement('button');
                        deleteBtn.classList.add('delete-btn');
                        deleteBtn.innerHTML = '&times;';
                        
                        // ‡πÉ‡∏ä‡πâ Closure ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏±‡∏ô‡∏à‡∏≥ index ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                        // ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ index ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        (function(currentIndex) {
                            deleteBtn.addEventListener('click', function() {
                                selectedFiles.splice(currentIndex, 1);
                                renderPreviews();
                            });
                        })(index);
            
                        imageCard.appendChild(img);
                        imageCard.appendChild(deleteBtn);
                        imagePreviewArea.appendChild(imageCard);
                    };
                    
                    reader.readAsDataURL(file);
                });
            }
            
            imageUpload.addEventListener('change', function(event) {
                const files = Array.from(event.target.files);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô Array
                selectedFiles = selectedFiles.concat(files);
                
                /*imageUpload.value = '';*/
            
                renderPreviews();
                });
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const inputWrapper = document.querySelector(".input-wrapper");
                const inputArea = document.getElementById("titleInput");
                const dynamicChip = document.getElementById("dynamicChip");
                const chipText = document.getElementById("chipText");
                const chipIcon = document.getElementById("chipIcon");
 
                const runOnceBtn = document.getElementById("quoteedit-bt");
                const aiBtn = document.getElementById("askai-bt");
                
                aiBtn.addEventListener("click", () => {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    if (!aiBtn.disabled) {
                        
                            chipText.textContent = "YouTube";
                            chipIcon.textContent = "smart_display"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                            dynamicChip.className = "post-type-label2 youtube";
        aiBtn.disabled = true;
                                
                        
                    } else {
                            console.log("899");
                            chipText.textContent = "mood";
                    chipIcon.textContent = "favorite_border"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                    dynamicChip.className = "post-type-label2 mood";
aiBtn.disabled = false;

                    }
                });
                
           
                /*function quoteedit() {*/
            
                runOnceBtn.addEventListener("click", () => {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    if (!runOnceBtn.disabled) {
                        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                        inputWrapper.style.setProperty("--before-background-color", "#536471");
                        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ margin-right ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
                        inputWrapper.style.setProperty("--before-margin-right", "15px");
            
                        runOnceBtn.disabled = true;
                    } else {
                       // console.log("999");
                        runOnceBtn.disabled = false;
            
                        inputWrapper.style.setProperty("--before-background-color", "transparent");
                        inputWrapper.style.setProperty("--before-margin-right", "0px");
                    }
                });
            
                /*inputArea.addEventListener('input', () => {
            console.log("titleinput");
            
            
            
            if (inputArea.value.trim().length > 0) {
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            inputWrapper.style.setProperty('--before-background-color', '#536471');
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ margin-right ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
            inputWrapper.style.setProperty('--before-margin-right', '15px'); 
            } else {
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            inputWrapper.style.setProperty('--before-background-color', 'transparent');
            inputWrapper.style.setProperty('--before-margin-right', '0px');
            }
            });*/
            });
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const tagInputContainer = document.getElementById("tagInputContainer");
                const submitButton = document.getElementById("submitButton");
                const resultDialog = document.getElementById("resultDialog");
                const tagList = document.getElementById("tagList");
                const closeDialog = document.getElementById("closeDialog");
            
                function getTagsFromHtml(html) {
                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = html;
                    const spans = tempDiv.querySelectorAll(".hashtag, .mention");
                    const tags = Array.from(spans).map((span) => span.textContent.trim());
                    return tags.filter((tag) => tag !== "");
                }
            
                tagInputContainer.addEventListener("input", (e) => {
                    const text = e.target.innerText;
                    const words = text.split(/\s+/);
            
                    let html = "";
                    words.forEach((word, index) => {
                        const trimmedWord = word.trim();
                        if (trimmedWord !== "") {
                            if (trimmedWord.startsWith("#")) {
                                html += `<span class="hashtag">${trimmedWord}</span>`;
                            } else if (trimmedWord.startsWith("@")) {
                                html += `<span class="mention">${trimmedWord}</span>`;
                            } else {
                                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏µ
                                html += `<span class="normal-text">${trimmedWord}</span>`;
                            }
                        }
                        if (index < words.length - 1) {
                            html += `<span class="space-span"> </span>`;
                        }
                    });
            
                    tagInputContainer.innerHTML = html;
            
                    // Keep the cursor at the end
                    const range = document.createRange();
                    const selection = window.getSelection();
                    range.selectNodeContents(tagInputContainer);
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                });
            
                submitButton.addEventListener("click", () => {
                    const tags = getTagsFromHtml(tagInputContainer.innerHTML);
            
                    tagList.innerHTML = "";
                    if (tags.length > 0) {
                        tags.forEach((tagText) => {
                            const li = document.createElement("li");
                            li.textContent = tagText;
                            tagList.appendChild(li);
                        });
                    } else {
                        const li = document.createElement("li");
                        li.textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ Tags & Mentions ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á";
                        tagList.appendChild(li);
                    }
            
                    resultDialog.showModal();
                });
            });
        </script>
        
        <script>
            const textarea = document.getElementById("titleInput");
            const dynamicChip = document.getElementById("dynamicChip");
            const chipText = document.getElementById("chipText");
            const chipIcon = document.getElementById("chipIcon");
            
            textarea.addEventListener("input", () => {
                const text = textarea.value;
            
                const hashtags = [...text.matchAll(/#([\p{L}\p{N}_]+)/gu)].map((m) => m[0]);
                const youtubeLinks = [...text.matchAll(/https?:\/\/(?:www\.)?youtu\S*/g)].map((m) => m[0]);
            
                if (youtubeLinks.length > 0) {
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube
                    chipText.textContent = "YouTube";
                    chipIcon.textContent = "smart_display"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                    dynamicChip.className = "post-type-label2 youtube";
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    chipText.textContent = "mood";
                    chipIcon.textContent = "favorite_border"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                    dynamicChip.className = "post-type-label2 mood";
                }
            });
        </script>
        <script>
                            const ua = navigator.userAgent;
            const isAndroid = /Android/i.test(ua);
            const isWebView = /\bwv\b/.test(ua) || /Version\/[\d.]+/.test(ua);

            console.log({ isAndroid, isWebView });

            if (isAndroid && isWebView) {
                document.documentElement.style.fontSize = "100%"; // 16 / 13.6 ‚âà 1.176
            }

            const supabase = window.supabase.createClient(
                "https://fkntlawaawawiusmjsez.supabase.co",

                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrbnRsYXdhYXdhd2l1c21qc2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5ODcxMjAsImV4cCI6MjA2NTU2MzEyMH0.G-_fLzcpvPla3dUYNCV7qh0j-JHo1Ahr5fS7fQkHdpw"
            );

            let currentFilter = "all"; // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ filter ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            let selectedCard = null; // ‡πÄ‡∏Å‡πá‡∏ö reference ‡∏Ç‡∏≠‡∏á card ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å Long Click
            let pinnedCards = []; // Array ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å DB
            let cameraStream; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö Stream ‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á

            async function saveFeeling() {
                const title = document.getElementById("titleInput").value.trim();
                const imageInput = document.getElementById("imageInput");

                if (!title && !imageInput.files.length) {
                    return;
                }


                if (imageInput.files.length) {
                    const urls = [];
                    for (let file of imageInput.files) {
                        const formData = new FormData();
                        formData.append("file", file);

                        const res = await fetch("https://uploads2.ballland10.workers.dev/upload", {
                            method: "POST",
                            body: formData,
                        });

                        const json = await res.json();
                        if (json.error) {
                            alert("‚ùå Upload Failed: " + json.error);
                            return;
                        }
                        urls.push(json.url);
                    }
                    await supabase.from("storyboard").insert({
                        type: "ig-pics",
                        file_url: JSON.stringify(urls),
                        title,
                    });
                    
                } else {
                    // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏î‡πâ‡∏ß‡∏¢ let ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
                    let typex = "mood"; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô "mood"

                    // ‡πÉ‡∏ä‡πâ .includes() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ 'youtube' ‡πÉ‡∏ô title ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (title.includes("youtube.com") || title.includes("youtu.be")) {
                        typex = "youtube";
                    }

                    await supabase.from("storyboard").insert({
                        type: typex,
                        title,
                    });
                }

                document.getElementById("titleInput").value = "";
                imageInput.value = "";
                
                
                
                const imageUpload = document.getElementById('imageInput');
                const imagePreviewArea = document.getElementById('image-preview-area');
                imageUpload.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô input file
                imagePreviewArea.innerHTML = ''; // ‡∏•‡∏ö preview ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î                                                                    
                hideInputBottomSheet();
                fetchTimeline();
            }

            async function fetchTimeline() {
                const [feelingsRes, notesRes, placesRes, posttagsRes, tagsRes] = await Promise.all([
                    supabase.from("storyboard").select("*, is_pinned, is_hidden,storyboard_places(id,name,address,latitude,longitude)").order("created_at", { ascending: true }),
                    supabase.from("NOTE").select("*, is_pinned, is_showtimeline, is_hidden").eq("is_showtimeline", true).order("created_at", { ascending: true }),
                    supabase.from("storyboard_places").select("*").order("created_at", { ascending: false }),
                    supabase.from("storyboard_posttags").select("*").order("created_at", { ascending: false }),
                    supabase.from("storyboard_typetags").select("*").order("created_at", { ascending: false }),
                ]);

                if (feelingsRes.error || notesRes.error) {
                    console.error(feelingsRes.error || notesRes.error);
                    return;
                }

                const posts = feelingsRes.data;
                const places = placesRes.data;
                const tags = tagsRes.data;
                const postTags = posttagsRes.data;

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Map ‡∏à‡∏≤‡∏Å UUID ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà -> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
                const placeMap = new Map();
                places.forEach((place) => {
                    placeMap.set(place.id, place);
                });

                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏û‡∏™‡∏ï‡πå
                posts.forEach((post) => {
                    post.place = placeMap.get(post.location) || null;
                });

                const tagsMap = new Map();
                tags.forEach((tag) => {
                    tagsMap.set(tag.id, tag);
                });

                const tagsByPostId = new Map();
                postTags.forEach((postTag) => {
                    if (!tagsByPostId.has(postTag.post_id)) {
                        tagsByPostId.set(postTag.post_id, []);
                    }
                    const tagInfo = tagsMap.get(postTag.tag_id);
                    if (tagInfo) {
                        tagsByPostId.get(postTag.post_id).push(tagInfo);
                    }
                });

                let timeline = [];
                pinnedCards = [];
                hiddenPosts = [];

                // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
                feelingsRes.data.forEach((item) => {
                    const tags = tagsByPostId.get(item.id) || [];
                    /*console.log('postTags sample:', postTags[0]);*/
                    /*console.log(tags.find(t => t.id === "6c83a4ad-4d63-4817-b6fc-3e481eed3477"));*/

                    timeline.push({ ...item, tags, place: item.place, type: item.type }); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ timeline
                    if (item.is_hidden) {
                        hiddenPosts.push({ ...item, type: item.type });
                    }
                    if (item.is_pinned) {
                        pinnedCards.push({ type: item.type, id: item.id, title: item.title, thumbnailUrl: "" });
                    }
                });

                notesRes.data.forEach((item) => {
                    timeline.push({ ...item, type: "note" }); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ timeline
                    if (item.is_hidden) {
                        hiddenPosts.push({ ...item, type: "note" });
                    }
                    if (item.is_pinned) {
                        pinnedCards.push({ type: "note", id: item.id, title: item.title, thumbnailUrl: "" });
                    }
                });

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Map ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ï‡∏≤‡∏° parent id (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°)
                const postsMap = new Map();
                timeline.forEach((post) => {
                    if (!post.group) {
                        postsMap.set(post.id, { ...post, children: [] });
                    }
                });

                // ... (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchTimeline ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) ...
                timeline.forEach((post) => {
                    if (post.group && postsMap.has(post.group)) {
                        postsMap.get(post.group).children.push(post);
                    }
                });

                postsMap.forEach((parentPost) => {
                    parentPost.children.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
                });

                let groupedTimeline = Array.from(postsMap.values());

                //sort(a,b)
                groupedTimeline.sort((b,a) => new Date(a.created_at) - new Date(b.created_at));

                const filteredTimeline = currentFilter === "all" ? groupedTimeline : groupedTimeline.filter((item) => item.type === currentFilter);

                await renderTimeline(filteredTimeline);
                if (typeof YT !== "undefined" && YT && YT.Player) {
                    setupYouTubePlayers();
                } else {
                    // ‡∏ñ‡πâ‡∏≤ YouTube API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
                    window.onYouTubeIframeAPIReady = function () {
                        setupYouTubePlayers();
                    };
                }
                // renderPinnedCards();
                // scrollToBottom();
            }

            // Global variable to store hidden posts
            let hiddenPosts = [];

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Hidden Posts Bottom Sheet
            function showHiddenPosts(id, type) {
                document.getElementById("hiddenPostsBottomSheet").classList.add("active");
                renderHiddenPosts(id, type);
            }

            function hideHiddenPosts() {
                document.getElementById("hiddenPostsBottomSheet").classList.remove("active");
            }

            async function renderHiddenPosts(postId, postType) {
                const container = document.getElementById("hiddenPostsContainer");
                container.innerHTML = "";

                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö id ‡πÅ‡∏•‡∏∞ type ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤
                const post = hiddenPosts.find((p) => p.id === postId && p.type === postType);

                if (post) {
                    const postCard = document.createElement("div");
                    postCard.className = "hidden-post-card";
                    postCard.innerHTML = `
            <div class="post-meta">
                <span class="post-type-label ${post.type}">
                
                ${post.type}</span>
                <span class="post-type-time">${getTimeAgo(post.created_at)}</span>
            </div>
            <div class="post-text">${marked.parse(post.title)}</div>
            <button class="action-button" onclick="unhidePost(${post.id}, '${post.type}')">‡πÄ‡∏•‡∏¥‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
        `;
                    container.appendChild(postCard);
                } else {
                    container.innerHTML = `<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô</p>`;
                }
            }

            async function renderTimeline(items) {
                const container = document.getElementById("postsContainer");
                container.innerHTML = "";

                items.forEach((item) => {
                    //console.log(item.is_hidden);

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å
                    const parentCard = document.createElement("div");

                    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (item.is_hidden != null) {
                        parentCard.className = "feed-post-hidden";
                    } else {
                        parentCard.className = "feed-post";
                    }
                    // ------------------

                    parentCard.setAttribute("data-type", item.type);
                    parentCard.setAttribute("data-id", item.id);

                    // HTML ‡∏Ç‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å (parent)
                    let html = renderPostContent(item, false);

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö child post
                    html += `<div class="child-container"></div>`;
                    parentCard.innerHTML = html;

                    container.appendChild(parentCard);

                    // Event toggle parent
                    const parentToggleButtons = parentCard.querySelectorAll(".toggle-detail");
                    parentToggleButtons.forEach((btn) => {
                        btn.addEventListener("click", () => {
                            showDeleteOptions(parentCard);
                        });
                    });
                    
                    
                    
                                        // Event toggle parent
                    const parentToggleButtons2 = parentCard.querySelectorAll(".toggle-detail2");
                    parentToggleButtons2.forEach((btn2) => {
                        btn2.addEventListener("click", () => {
                            showDeleteOptions2(parentCard);
                            
                        });
                    });
                    
                    
                    
                    
                    
                    

                    // ‡∏´‡∏≤ child container
                    const childContainer = parentCard.querySelector(".child-container");

                    // ‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á child post
                    if (item.children && item.children.length > 0) {
                        item.children.forEach((child) => {
                            const childCard = document.createElement("div");
                            childCard.className = "feed-post child-post";
                            childCard.setAttribute("data-type", child.type);
                            childCard.setAttribute("data-id", child.id);

                            // HTML ‡∏Ç‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡∏π‡∏Å (child)
                            childCard.innerHTML = renderPostContent(child, true);

                            childContainer.appendChild(childCard);

                            // Event toggle child
                            const childToggleButtons = childCard.querySelectorAll(".toggle-detail");
                            childToggleButtons.forEach((btn) => {
                                btn.addEventListener("click", () => {
                                    showDeleteOptions(childCard);
                                });
                            });
                        });
                    }
                });

                //scrollToBottom();
            }

            let players = {}; // ‡πÄ‡∏Å‡πá‡∏ö player ‡πÅ‡∏ï‡πà‡∏•‡∏∞ video id
            let playingVideoId = null; // video id ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà

            function setupYouTubePlayers() {
                const ytCards = document.querySelectorAll(".yt-card[data-video-id]");

                ytCards.forEach((card) => {
                    const vid = card.getAttribute("data-video-id");
                    const playBtn = card.querySelector(".play-btn");
                    const openBtn = card.querySelector(".open-btn");

                    if (!playBtn || !vid) return;

                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ player ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö video id ‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á
                    if (!players[vid]) {
                        let playerDiv = document.getElementById(`player-${vid}`);
                        if (!playerDiv) {
                            playerDiv = document.createElement("div");
                            playerDiv.id = `player-${vid}`;
                            playerDiv.style.width = "1px";
                            playerDiv.style.height = "1px";
                            playerDiv.style.opacity = "0";
                            playerDiv.style.position = "absolute";
                            playerDiv.style.pointerEvents = "none";
                            document.body.appendChild(playerDiv);
                        }
                        players[vid] = new YT.Player(playerDiv.id, {
                            height: "1",
                            width: "1",
                            videoId: vid,
                            playerVars: {
                                autoplay: 0,
                                controls: 0,
                                modestbranding: 1,
                                rel: 0,
                                loop: 1,
                                playlist: vid,
                            },
                            events: {
                                onStateChange: onPlayerStateChange,
                            },
                        });
                    }

                    // ‡∏õ‡∏∏‡πà‡∏° Play/Pause
                    playBtn.onclick = () => {
                        const player = players[vid];
                        if (!player) return;

                        if (playingVideoId === vid) {
                            // ‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                            player.pauseVideo();
                            playingVideoId = null;
                            playBtn.textContent = "play_arrow";
                        } else {
                            // ‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                            if (playingVideoId && players[playingVideoId]) {
                                players[playingVideoId].pauseVideo();
                                const prevBtn = document.querySelector(`.yt-card[data-video-id="${playingVideoId}"] .play-btn`);
                                if (prevBtn) prevBtn.textContent = "play_arrow";
                            }
                            // ‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡∏°‡πà
                            player.playVideo();
                            playingVideoId = vid;
                            playBtn.textContent = "pause";
                        }
                    };

                    // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube
                    if (openBtn) {
                        openBtn.onclick = () => {
                            window.open(`https://www.youtube.com/watch?v=${vid}`, "_blank");
                        };
                    }
                });
            }

            // ‡∏ü‡∏±‡∏á‡∏ä‡∏±‡πà‡∏ô‡∏à‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á player (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏à‡∏∞ sync UI ‡∏î‡∏µ)
            function onPlayerStateChange(event) {
                if (event.data === YT.PlayerState.ENDED) {
                    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö
                    const endedVid = event.target.getVideoData().video_id;
                    const btn = document.querySelector(`.yt-card[data-video-id="${endedVid}"] .play-btn`);
                    if (btn) btn.textContent = "‚ñ∂Ô∏è";
                    if (playingVideoId === endedVid) playingVideoId = null;
                }
            }

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î timeline ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ YouTube API ‡∏û‡∏£‡πâ‡∏≠‡∏°
            function onYouTubeIframeAPIReady() {
                setupYouTubePlayers();
            }

            function getTimeAgo(dateString) {
                const now = new Date();
                const postDate = new Date(dateString);
                const diff = (now - postDate) / 1000;

                if (diff < 60) return "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡πâ‡∏ô‡∏µ‡πâ";
                if (diff < 3600) {
                    const mins = Math.floor(diff / 60);
                    return `${mins} ‡∏ô‡∏≤‡∏ó‡∏µ`;
                }
                if (diff < 86400) {
                    const hours = Math.floor(diff / 3600);
                    return `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
                }
                if (diff < 2592000) {
                    const days = Math.floor(diff / 86400);
                    return `${days} ‡∏ß‡∏±‡∏ô`;
                }
                if (diff < 31536000) {
                    const months = Math.floor(diff / 2592000);
                    return `${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
                }
                const years = Math.floor(diff / 31536000);
                return `${years} ‡∏õ‡∏µ`;
            }

            function renderPostContent(item, isChild = false) {
                const timeRelative = getTimeAgo(item.created_at);
                /* const time = new Date(item.created_at).toLocaleString('th-TH', {
        month: 'short', day: 'numeric', year: 'numeric',
        hour: '2-digit', minute: '2-digit', hour12: false
    }).replace('‡∏û.‡∏Ñ.', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°');*/

                /* const time = new Date(item.created_at).toLocaleString('th-TH', {
    day: '2-digit',
    month: 'short',
    year: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    hour12: false
});*/
                const d = new Date(item.created_at);
                const day = String(d.getDate()).padStart(2, "0");
                const monthNames = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
                const month = monthNames[d.getMonth()];
                // ‡∏õ‡∏µ ‡∏Ñ.‡∏®. 2 ‡∏´‡∏•‡∏±‡∏Å ‡∏ï‡∏±‡∏î‡πÅ‡∏Ñ‡πà 2 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ‡πÄ‡∏ï‡πá‡∏°
                const year = String(d.getFullYear()).slice(-2);
                const hour = String(d.getHours()).padStart(2, "0");
                const minute = String(d.getMinutes()).padStart(2, "0");

                const time = `${day} ${month} ${year} ${hour}:${minute}`;

                //‡∏ï‡∏±‡∏ß‡∏ã‡πà‡∏≠‡∏ô

                if (item.is_hidden) {
                    const hiddenReason = item.is_hidden;
                    return `
        
        <div class="post-hide" style="text-align: center;" onclick="showHiddenPosts(${item.id}, '${item.type}')">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô: "${hiddenReason}"</div>
            
            
        `;
                }

                let html = `<div class="post-meta">`;
                if (!isChild) {
                  /*  html += `<span class="post-type-label ${item.type}"><i class="post-type-icon">favorite_border</i>${item.type}</span>`;*/
                    html += `<span class="post-type-useraccount"><div class="profile-container toggle-detail2"><img src="https://pub-bcd0954facce440ca60e0171468dafc9.r2.dev/1755737531556_1000019090.jpg" class="profile-pic"></div><div style="display: flex;  flex-direction: column;"><span style="font-weight: bold">takahiro199x</span><span class="post-type-label-text ${item.type}" style= "text-transform: uppercase; color:white;">${item.type}</span></div></span>`;
                    
                }
                html += `<span class="post-type-time toggle-detail"> ${timeRelative} ‚Ä¢ ${time}</span></div>`;

                if (item.type === "mood" || item.type === "moment") {
                    let text = item.title; // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏¥‡∏ö
                    let htmlContent = text.replace(/\n/g, "<br>");
                    html += `<div class="post-text">${htmlContent}</div>`;
                } else if (item.type === "youtube") {
                    const vid = extractYouTubeID(item.title);
                    const cleanedTitle = item.title.replace(/https?:\/\/(www\.)?(youtube\.com|youtu\.be)\/[^\s]+/g, "").trim();
                    html += `<div class="post-text">${cleanedTitle}</div>`;

                    /*if (vid) html += `<iframe src="https://www.youtube.com/embed/${vid}" frameborder="0" allowfullscreen></iframe>`;*/

                    if (vid) {
                        html += `
         <div class="yt-card" data-video-id="${vid}">
        <img class="yt-thumb" src="https://img.youtube.com/vi/${vid}/maxresdefault.jpg" alt="Thumbnail" crossorigin="anonymous"/>
        <div style="flex:1; overflow:hidden;">
          <div class="yt.title">${cleanedTitle || "YouTube Video"}</div>
          <div class="yt-channel">YouTube</div>
        </div>
            
        <div class="controls" style="display:flex; flex-direction:column; gap:4px;">
            <button class="material-icons open-btn">open_in_new</button>                       
            <button class="material-icons play-btn">play_arrow</button>
               
        </div>
      </div>
    `;
                    }
                } else if (item.type === "note") {
                    html += `<div class="post-text"><span class="note-link" onclick="openNote('${item.id}')">${item.title}</span></div>`;
                } else if (item.type === "quote") {
                    html += `<div class="post-quote"><div class="post-text">${marked.parse(item.title)}</div></div>`;
                } else if (item.type === "ig-pics") {
                    html += `<div class="post-text">${item.note || ""}</div>`;
                    let urls = [];
                    try {
                        urls = JSON.parse(item.file_url);
                        if (!Array.isArray(urls)) urls = [urls];
                    } catch {
                        urls = [item.file_url];
                    }

                    html += `<div class="post-img-group">`;
                    const imagesToShow = urls.slice(0, 4);
                    imagesToShow.forEach((url) => {
                        html += `<img src="${url}" alt="upload" loading="lazy" onclick="openImageModal('${url}')"/>`;
                    });

                    if (urls.length > 4) {
                        html += `<div class="more-images" onclick="openImageModal([${urls.map((url) => `'${url}'`).join(",")}])">`;
                        html += `+${urls.length - 4}`;
                        html += `</div>`;
                    }
                    html += `</div>`;
                }

                if (item.place) {
                    html += `
      <div class="post-location">
       <span class="post-location-icon">place</span>
        <div style="flex:1; overflow:hidden;">
          <div class="location-title">${item.place.name}</div>
          <div class="location-address">${item.place.address || ""}</div>
        </div>      
      </div>
    `;
                }

                /*  console.log('tags:', item.tags);*/
                if (item.tags && item.tags.length > 0) {
                    html += '<div class="post-tags">';
                    item.tags.forEach((tag) => {
                        html += `<span class="tag ${tag.tag_type}" style="color:${tag.color}">${tag.tag_text}</span>`;
                    });
                    html += "</div>";
                }

                return html;
            }

            async function unhidePost(id, type) {
                const table = type === "mood" || type === "youtube" ? "storyboard" : type === "note" ? "NOTE" : type + "s";

                const { error } = await supabase
                    .from(table)
                    .update({ is_hidden: null }) // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô null
                    .eq("id", id);

                if (error) {
                    console.error("Error unhiding post:", error);
                    alert("Failed to unhide post.");
                } else {
                    alert("‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡πâ‡∏ß");
                    hideHiddenPosts(); // ‡∏õ‡∏¥‡∏î Bottom Sheet
                    fetchTimeline(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                }
            }

            //scrollToBottom();

            /* const allImages = container.querySelectorAll('.post-img-group img'); // Changed to post-img-group
            allImages.forEach(img => {
                if (!img.complete) {
                    img.onload = () => scrollToBottom();
                    img.onerror = () => scrollToBottom();
                }
            });
        }*/

            function scrollToBottom() {
                const container = document.getElementById("feedContainer"); // Changed to feedContainer
                container.scrollTop = container.scrollHeight;
            }

            function extractYouTubeID(url) {
                const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|shorts\/))([^\s&?/]+)/);
                return match ? match[1] : "";
            }

            function isYouTubeUrl(url) {
                return url.includes("youtube.com") || url.includes("youtu.be");
            }

            function openNote(id) {
                location.href = `/edit.html?noteId=${id}`;
            }

            // Filter Logic
            function showFilterOptions() {
                //document.getElementById('filterBottomSheet').classList.add('active');

                const notesContainer = document.getElementById("feedContainer");

                const isCard = notesContainer.classList.toggle("feed-post-cardview");
                // toggleBtn.textContent = isCard ? "format_list_bulleted" : "dashboard";
            }

            function hideFilterOptions() {
                document.getElementById("filterBottomSheet").classList.remove("active");
            }

            document.getElementById("filterOptions").addEventListener("click", (event) => {
                if (event.target.tagName === "BUTTON") {
                    document.querySelectorAll("#filterOptions button").forEach((btn) => btn.classList.remove("active"));
                    event.target.classList.add("active");
                    currentFilter = event.target.dataset.filter;
                    fetchTimeline();
                    hideFilterOptions(); // ‡∏õ‡∏¥‡∏î Bottom Sheet ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Filter
                }
            });







            // Functions for Delete/Pin Bottom Sheet
            function showDeleteOptions(cardElement) {
                selectedCard = cardElement;
                document.getElementById("deleteBottomSheet").classList.add("active");

                // Update Pin/Unpin button text
                const pinButton = document.querySelector("#deleteBottomSheet .pin-action");
                const type = selectedCard.getAttribute("data-type");
                const id = parseInt(selectedCard.getAttribute("data-id")); // Ensure ID is integer for comparison
                const isPinned = pinnedCards.some((p) => p.type === type && p.id === id);

           
           let posttext= document.getElementById('post-text-getter');

                
                console.log(id);
                
                
                
                

                /*   const post = hiddenPosts.find(p => p.id === postId && p.type === postType);*/

                let postTextElement = selectedCard.querySelector(".post-text");

                
               posttext.textContent=postTextElement.textContent;
                
            }




          // Functions for Delete/Pin Bottom Sheet
            function showDeleteOptions2(cardElement) {
                selectedCard = cardElement;
                document.getElementById("replyBottomSheet").classList.add("active");



        const titleInput = document.getElementById("titleInput6");
            
                titleInput.focus(); // Focus on the textarea when opened
                setTimeout(() => {
                    titleInput.focus();
                }, 100); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 100 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            






                // Update Pin/Unpin button text
                const pinButton = document.querySelector("#deleteBottomSheet .pin-action");
                const type = selectedCard.getAttribute("data-type");
                const id = parseInt(selectedCard.getAttribute("data-id")); // Ensure ID is integer for comparison
                const isPinned = pinnedCards.some((p) => p.type === type && p.id === id);

           
           let posttext= document.getElementById('post-text-getter');

                
                console.log(selectedCard);
                
                
                
                

                /*   const post = hiddenPosts.find(p => p.id === postId && p.type === postType);*/

                let postTextElement = selectedCard.querySelector(".post-text");

                
            /*   posttext.textContent=postTextElement.textContent;*/
                
                
                posttext.innerHTML = selectedCard.innerHTML;
                //outerHTML
            }













            function hideDeleteOptions() {
                document.getElementById("deleteBottomSheet").classList.remove("active");
                selectedCard = null;
            }
            function hideDeleteOptions2() {
                document.getElementById("replyBottomSheet").classList.remove("active");
                selectedCard = null;
            }

            async function confirmDelete() {
                if (selectedCard) {
                    const type = selectedCard.getAttribute("data-type");
                    const id = selectedCard.getAttribute("data-id");
                    await deleteItem(type, id); // deleteItem ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fetchTimeline ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    hideDeleteOptions();
                }
            }
            
            async function deleteItem(type, id) {
            // Updated table name logic: 'note' now maps to 'NOTE'
            const table = type === 'mood' || type === 'youtube' || type === 'ig-pics' ? 'storyboard' : (type === 'note' ? 'NOTE' : type + 's');
            const {
                error
            } = await supabase.from(table).delete().eq('id', id);

            if (error) console.error(error);
            fetchTimeline(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fetchTimeline ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÅ‡∏•‡∏∞ Pinned Cards
        }


            async function togglePinCard() {

                
                
                
                
                const id = parseInt(selectedCard.getAttribute("data-id")); // Ensure ID is integer
                                const titleInput = document.getElementById("titleInput6").value.trim();

                console.log(titleInput.textContent); 
                
             /*   fetchTimeline(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fetchTimeline ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î     */              
                hideDeleteOptions();
                
              /*  await supabase.from("storyboard").insert({
                        type: "mood",
                        title: "tesx",
                        group: id,
                    });*/
                
                
            }
            
            
            
            
            async function togglePinCard2() {                                                                        
                
                const id = parseInt(selectedCard.getAttribute("data-id")); // Ensure ID is integer
                const titleInput = document.getElementById("titleInput6");
              
               /* console.log(titleInput.textContent); */
                
                const title = titleInput.value;
                console.log(title);                
                console.log(id);
                
              
                
              await supabase.from("storyboard").insert({
                        type: "mood",
                        title: title,
                        group: id,
                    });
                    
                    
                    setTimeout(() => {
                    fetchTimeline();
                    hideDeleteOptions2();
                }, 1500); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 100 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                    
                    
                
                
            }

            // Render Pinned Cards
            /* function renderPinnedCards() {
            const container = document.getElementById('pinnedCardsContainer');
            container.innerHTML = '';

            if (pinnedCards.length > 0) {
                document.body.classList.add('has-pinned-cards');
            } else {
                document.body.classList.remove('has-pinned-cards');
            }

            pinnedCards.forEach(pin => {
                const pinnedCardDiv = document.createElement('div');
                pinnedCardDiv.className = 'pinned-card';
                pinnedCardDiv.setAttribute('data-type', pin.type);
                pinnedCardDiv.setAttribute('data-id', pin.id);
                pinnedCardDiv.onclick = () => scrollToCard(pin.id, pin.type);

                let contentHtml = `<span class="post-type-label ${pin.type}">${pin.type}</span>`; // Changed to post-type-label
                if (pin.thumbnailUrl) {
                    contentHtml += `<img src="${pin.thumbnailUrl}" alt="thumbnail" style="width:30px; height:30px; border-radius:50%; object-fit:cover;">`;
                }
                contentHtml += `<span>${pin.title.substring(0, 30)}${pin.title.length > 30 ? '...' : ''}</span>`;
                contentHtml += `<button class="close-pin-button" onclick="event.stopPropagation(); removePin('${pin.type}', '${pin.id}')"><i class="fas fa-times"></i></button>`;

                pinnedCardDiv.innerHTML = contentHtml;
                container.appendChild(pinnedCardDiv);
            });
        }*/

            /*  function removePin(type, id) {
            const actualId = parseInt(id);
            const actualType = type;
            // Updated table name logic: 'note' now maps to 'NOTE'
            const table = actualType === 'emotion' || actualType === 'youtube' ? 'feelings' : (actualType === 'note' ? 'NOTE' : actualType + 's');

            supabase.from(table)
                .update({ is_pinned: false })
                .eq('id', actualId)
                .then(({ data, error }) => {
                    if (error) {
                        console.error('Error unpinning from DB:', error);
                        alert('Failed to unpin card.');
                    } else {
                        console.log('Unpinned from DB:', data);
                        fetchTimeline(); // Re-fetch to update all UI
                    }
                });
        }*/

            function scrollToCard(id, type) {
                const cardElement = document.querySelector(`.feed-post[data-id="${id}"][data-type="${type}"]`); // Changed to feed-post
                if (cardElement) {
                    cardElement.scrollIntoView({ behavior: "smooth", block: "start" });
                }
            }

            // New Emoji Popover Functions
            function toggleEmojiPopover() {
                const popover = document.getElementById("emojiSelectionPopover");
                popover.style.display = popover.style.display === "block" ? "none" : "block";
            }

            // Attach click handlers to emojis inside the popover
            document.querySelectorAll("#emojiSelectionPopover .emoji-button").forEach((btn) => {
                btn.onclick = () => {
                    const input = document.getElementById("titleInput");
                    input.value += btn.textContent + " ";
                    input.focus();
                    toggleEmojiPopover(); // Hide after selection
                };
            });

            // Hide emoji popover when clicking outside
            document.addEventListener("click", function (event) {
                const popover = document.getElementById("emojiSelectionPopover");
                const trigger = document.querySelector(".input-sheet-actions .icon-button:nth-child(1)"); // Targeted the emoji button in bottom sheet
                const inputField = document.getElementById("titleInput");
                const inputBottomSheet = document.getElementById("inputBottomSheet");

                if (popover.style.display === "block" && !popover.contains(event.target) && !trigger.contains(event.target) && event.target !== inputField && !inputBottomSheet.contains(event.target)) {
                    popover.style.display = "none";
                }
            });

            // Image Modal Functions
            function openImageModal(data) {
                const modal = document.getElementById("imageModal");
                const imageContainer = document.getElementById("fullImageContainer");
                imageContainer.innerHTML = ""; // Clear previous images

                if (typeof data === "string") {
                    // Single image URL
                    const img = document.createElement("img");
                    img.src = data;
                    imageContainer.appendChild(img);
                } else if (Array.isArray(data)) {
                    // Array of image URLs for gallery
                    data.forEach((url) => {
                        const img = document.createElement("img");
                        img.src = url;
                        imageContainer.appendChild(img);
                    });
                }

                modal.classList.add("active");
            }

            function closeImageModal() {
                document.getElementById("imageModal").classList.remove("active");
                document.getElementById("fullImageContainer").innerHTML = ""; // Clear images when closing
            }

            // Close modal if clicking outside content
            document.getElementById("imageModal").addEventListener("click", (event) => {
                if (event.target.id === "imageModal") {
                    // Only if clicked on the overlay itself, not its children
                    closeImageModal();
                }
            });

            // Camera Functions
            const cameraModal = document.getElementById("cameraModal");
            const cameraFeed = document.getElementById("cameraFeed");

            async function openCameraModal() {
                cameraModal.classList.add("active");
                try {
                    // Request access to the camera
                    cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
                    cameraFeed.srcObject = cameraStream;
                } catch (err) {
                    console.error("Error accessing camera: ", err);
                    alert("Cannot access camera. Please ensure you have granted camera permissions.");
                    closeCameraModal(); // Close modal if camera access fails
                }
            }

            function closeCameraModal() {
                if (cameraStream) {
                    cameraStream.getTracks().forEach((track) => track.stop()); // Stop all tracks (video, audio)
                    cameraStream = null;
                }
                cameraFeed.srcObject = null; // Disconnect the stream from the video element
                cameraModal.classList.remove("active");
            }

            function capturePhoto() {
                const canvas = document.createElement("canvas");
                canvas.width = cameraFeed.videoWidth;
                canvas.height = cameraFeed.videoHeight;
                const context = canvas.getContext("2d");
                context.drawImage(cameraFeed, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(async (blob) => {
                    if (blob) {
                        const capturedFile = new File([blob], "captured_image.png", { type: "image/png" });
                        const imageInput = document.getElementById("imageInput");

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á DataTransfer object ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(capturedFile);

                        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î files ‡∏Ç‡∏≠‡∏á input element ‡∏î‡πâ‡∏ß‡∏¢ DataTransfer's files
                        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÄ‡∏ä‡πà‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ property 'files' ‡∏Ç‡∏≠‡∏á input ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                        // ‡∏ã‡∏∂‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
                        // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô UI ‡∏Ç‡∏≠‡∏á input file
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏±‡πâ‡∏ô‡πÜ
                        imageInput.files = dataTransfer.files;

                        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ saveFeeling ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å imageInput ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        //await saveFeeling();
                        closeCameraModal(); // ‡∏õ‡∏¥‡∏î Modal ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÄ‡∏™‡∏£‡πá‡∏à
                    } else {
                        console.error("Failed to create blob from canvas.");
                        alert("Could not capture photo.");
                    }
                }, "image/png");
            }

            // Input Bottom Sheet Logic
            const inputBottomSheet = document.getElementById("inputBottomSheet");
            const titleInput = document.getElementById("titleInput");

            function showInputBottomSheet() {
                inputBottomSheet.classList.add("active");
                console.log(titleInput);
                titleInput.focus(); // Focus on the textarea when opened
                setTimeout(() => {
                    titleInput.focus();
                }, 100); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 100 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            }

            function hideInputBottomSheet() {
                inputBottomSheet.classList.remove("active");
            }

            // Hide input bottom sheet when clicking overlay itself
            inputBottomSheet.addEventListener("click", (event) => {
                if (event.target === inputBottomSheet) {
                    hideInputBottomSheet();
                }
            });

            // Initial load
            window.addEventListener("DOMContentLoaded", () => {
                fetchTimeline(); // fetchTimeline ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á pinned cards ‡πÅ‡∏•‡∏∞ render ‡πÄ‡∏≠‡∏á
            });

            let lastScrollTop = 0;
            const navbar = document.getElementById("navbar");
            const openBtnAI = document.getElementById("openBtnAI");
            const openBtnCreate = document.getElementById("openBtnCreate");
            const openBtnSora = document.getElementById("openBtnSora");
            
            const feedContainer = document.getElementById("feedContainer");

openBtnSora.addEventListener("click", (event) => {
                	window.location.href = "SoraAI_igchat.html";     
            
                });

            feedContainer.addEventListener("scroll", function () {
                const currentScroll = feedContainer.scrollTop;
                
                

                if (currentScroll > lastScrollTop) {
                    // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á ‚Üí ‡∏ã‡πà‡∏≠‡∏ô header
                    
                    openBtnAI.style.visibility = "hidden";
                    openBtnSora.style.visibility = "hidden";
                    openBtnCreate.style.visibility = "hidden";                 
                    navbar.style.transform = "translateY(-100%)";
                    
                } else {
                    // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí ‡πÅ‡∏™‡∏î‡∏á header
                    openBtnAI.style.visibility = "visible";
                    openBtnCreate.style.visibility = "visible";             
                    openBtnSora.style.visibility = "visible";
                    navbar.style.transform = "translateY(0)";
                }

                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            });
                </script>
        
        
        
        
        
    </body>
</html>
